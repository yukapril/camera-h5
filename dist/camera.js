!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Camera=e()}(this,function(){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(t,e){var i=new window.FileReader;i.onload=function(t){t=t.target.result;i=null,e&&e(null,t)},i.onerror=function(t){i=null,e&&e(t,"")},i.readAsDataURL(t)};function a(t,a,l){t.addEventListener("change",function(t){l.onChange(t);var i,e,n=t.target.files;0<n.length&&(e=(i=n[0]).type,t=a.type,n=e,0<=t.split(",").indexOf(n)?o(i,function(t,e){t?l.onChanged({type:"error file",err:"Illegal file:"+i,error:t},"",null):l.onChanged(null,e,i)}):l.onChanged({type:"type",err:"Illegal type: "+e},"",null))})}function l(t){return t.split(",")[1].replace(/=/g,"").length/4*3}function r(t){return t.substring(5,t.indexOf(";"))}function h(t,e,i){n(this,h),this.width=e||null,this.height=i||null,this.size=l(t)||null,this.base64=t||null,this.type=r(t)}function u(t,e){var i=new window.Image;i.onload=function(){e&&e(null,new c(t,i)),i=null},i.onerror=function(t){i=null,e&&e(t,{})},i.src=t}function g(t,e,i,n){var a;e.limit--,e.limit<0?n&&n(e.validImgInfo):(a=d(e,t)).size<=t.maxSize&&t.maxSize-a.size<=t.maxSize*t.offsetRatio?n&&n(a):a.size<=t.maxSize?.9<e.ratio?n&&n(a):(e.ratioMin=e.ratio,e.ratio=(e.ratioMax+e.ratio)/2,e.validImgInfo=a,g(t,e,!1,n)):(e.ratioMax=e.ratio,e.ratio=(e.ratioMin+e.ratio)/2,i&&(e.maxImgBase64=a.base64,e.ratio=.5,e.ratioMin=0,e.ratioMax=1),g(t,e,!1,n))}function s(e){var i=document.createElement("img");i.onload=function(){var t="from-image"===window.getComputedStyle(i).imageOrientation;document.body.removeChild(i),i=null,e&&e(t)},document.body.appendChild(i),i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAApJREFUCNdjYAAAAAIAAeIhvDMAAAAASUVORK5CYII="}function f(t,a,l,o,r,h){e(t,function(t){if(1===t||3===t||6===t||8===t){var e=(n=document.createElement("canvas")).getContext("2d"),i=m(t);switch(i){case 90:n.width=a.height,n.height=a.width,e.fillStyle="#fff",e.fillRect(0,0,n.width,n.height),e.translate(a.height,0),e.rotate(i*Math.PI/180),e.drawImage(a.img,0,0,n.height,n.width);break;case 180:n.width=a.width,n.height=a.height,e.fillStyle="#fff",e.fillRect(0,0,n.width,n.height),e.translate(a.width,a.height),e.rotate(i*Math.PI/180),e.drawImage(a.img,0,0,n.width,n.height);break;case 270:n.width=a.height,n.height=a.width,e.fillStyle="#fff",e.fillRect(0,0,n.width,n.height),e.translate(0,a.width),e.rotate(i*Math.PI/180),e.drawImage(a.img,0,0,n.height,n.width);break;case 0:n.width=a.width,n.height=a.height,e.fillStyle="#fff",e.fillRect(0,0,n.width,n.height),e.translate(0,0),e.rotate(i*Math.PI/180),e.drawImage(a.img,0,0,n.width,n.height)}var t=n.toDataURL(r,h),e=null,n=null;o&&o(null,t)}else o&&o(null,l)})}var c=function t(e,i){n(this,t),this.width=i.width||null,this.height=i.height||null,this.size=l(e)||null,this.base64=e||null,this.type=r(e),this.img=i||null},d=function(t,e){var i=e.type,n=e.quality,a=t.width,l=t.height,o=t.ratio,r=t.img,t=(e=document.createElement("canvas")).getContext("2d");e.width=a*o,e.height=l*o,t.fillStyle="#fff",t.fillRect(0,0,e.width,e.height),t.drawImage(r,0,0,e.width,e.height);r=e.toDataURL(i,n),i=e.width,n=e.height,t=null,e=null;return new h(r,i,n)},e=function(t,u){var e=new window.FileReader;e.onload=function(t){var e=new window.DataView(t.target.result);if(65496===e.getUint16(0,!1)){for(var i,n=e.byteLength,a=2;a<n;){var l=e.getUint16(a,!1);if(a+=2,65505===l){1165519206!==e.getUint32(a+=2,!1)&&(i=-1);var o=18761===e.getUint16(a+=6,!1);a+=e.getUint32(a+4,o);var r=e.getUint16(a,o);a+=2;for(var h=0;h<r;h++)274===e.getUint16(a+12*h,o)&&(i=e.getUint16(a+12*h+8,o))}else{if(65280!=(65280&l))break;a+=e.getUint16(a,!1)}}u(i||-1)}else u(-2)},e.onerror=function(){u(-3)},e.readAsArrayBuffer(t)},m=function(t){var e=null;switch(t){case 1:e=0;break;case 6:e=90;break;case 3:e=180;break;case 8:e=270;break;default:e=0}return e};function p(t,e){n(this,p),(t=i="string"==typeof(i=t)?document.querySelector(i):i).style.position="relative";var i={_self:this,root:t,opts:e,options:{},input:null};this.$$data=i,this.callback={onChanged:function(){},onChange:function(){}},i.options=function(t){return{type:(t=0<arguments.length&&void 0!==t?t:{}).type||"image/jpeg",capture:t.capture||"camera"}}(i.opts),i.input=function(t){var e=null;switch(t.capture){case"camera":e="camera";break;case"user":e="user";break;case"none":e="";break;default:e="camera"}return(t=document.createElement("input")).type="file",t.setAttribute("accept","image/*"),e&&t.setAttribute("capture",e),t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.zIndex="9999",t.style.display="block",t.style.width="100%",t.style.height="100%",t.style.opacity="0",t}(i.options),t=i.root,e=i.input,t.appendChild(e),a(i.input,i.options,this.callback)}return p.getSize=l,p.getImgInfo=u,p.compress=function(t,e,i){var n={maxLength:e.maxLength||1920,maxSize:e.maxSize||307200,type:e.type||"image/jpeg",quality:e.quality||.8,offsetRatio:e.offsetRatio||.2},a={ratio:1,ratioMax:1,ratioMin:0,limit:5,validImgInfo:"",maxImgBase64:"",width:0,height:0,img:null};u(t,function(t,e){t?i&&i(t,{}):(a.maxImgBase64=e.base64,a.width=e.width,a.height=e.height,a.img=e.img,n.type!==e.type?g(n,a,!0,function(t){i&&i(null,t)}):e.width<=n.maxLength&&e.height<=n.maxLength?e.size<=n.maxSize?i&&i(null,e):g(n,a,!1,function(t){i&&i(null,t)}):(t=Math.max(e.width,e.height),e=null,a.ratio=a.ratioMax=n.maxLength/t,g(n,a,!0,function(t){i&&i(null,t)})))})},p.rotate=function(n,a){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},l={type:t.type||"image/jpeg",quality:t.quality||90,auto:!!t.auto};o(n,function(t,i){t?a&&a(t,""):u(i,function(t,e){t?a&&a(t,""):l.auto?s(function(t){t?a(null,i):f(n,e,i,a,l.type,l.quality)}):f(n,e,i,a,l.type,l.quality)})})},p.isRotated=s,p});
