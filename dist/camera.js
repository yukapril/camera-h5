!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Camera=e()}(this,function(){"use strict";var t=function(t){return"string"==typeof t&&(t=document.querySelector(t)),t},e=function(t){var e=t.opts||{};t.opts={type:e.type||"image/jpeg"}},i=function(t){var e=document.createElement("input");e.type="file",e.setAttribute("accept","image/*"),e.setAttribute("capture","camera"),e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.display="block",e.style.width="100%",e.style.height="100%",e.style.opacity="0",t.input=e},n=function(t){t.el.appendChild(t.input)},r=function(t,e){var i=new window.FileReader;i.onload=function(t){var n=t.target.result;i=null,e&&e(null,n)},i.onerror=function(){i=null,e&&e("read file error","")},i.readAsDataURL(t)},a=function(t,e){return t.split(",").indexOf(e)>=0},o=function(t){t.input.addEventListener("change",function(e){var i=e.target.files;if(i.length>0){var n=i[0],o=n.type;if(!a(t.opts.type,o))return void t.errorFn.call(t._self,{type:"type",err:"Illegal type: "+o});r(n,function(e,i){e?t.errorFn.call(t._self,{type:"error file",err:"Illegal file:"+n}):t.events.forEach(function(t){return t(i,n)})})}})},l=function(t){var e=t.split(",")[1];return(e=e.replace(/=/g,"")).length/4*3},u=(function(){function t(t){this.value=t}function e(e){function i(r,a){try{var o=e[r](a),l=o.value;l instanceof t?Promise.resolve(l.value).then(function(t){i("next",t)},function(t){i("throw",t)}):n(o.done?"return":"normal",o.value)}catch(t){n("throw",t)}}function n(t,e){switch(t){case"return":r.resolve({value:e,done:!0});break;case"throw":r.reject(e);break;default:r.resolve({value:e,done:!1})}(r=r.next)?i(r.key,r.arg):a=null}var r,a;this._invoke=function(t,e){return new Promise(function(n,o){var l={key:t,arg:e,resolve:n,reject:o,next:null};a?a=a.next=l:(r=a=l,i(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),h=function t(e,i){u(this,t),this.width=i.width||null,this.height=i.height||null,this.size=l(e)||null,this.base64=e||null,this.img=i||null},f=function(t,e){var i=new window.Image;i.src=t,i.onload=function(){var n=new h(t,i);e&&e(null,n),i=null},i.onerror=function(){i=null,e&&e("get image info error",{})}},s=function(t,e){var i=e.quality,n=t.width,r=t.height,a=t.ratio,o=t.img,u=document.createElement("canvas"),h=u.getContext("2d");u.width=n*a,u.height=r*a,h.fillStyle="#fff",h.fillRect(0,0,u.width,u.height),h.drawImage(o,0,0,u.width,u.height);var f=u.toDataURL("image/jpeg",i),s=u.width,c=u.height;return h=null,u=null,{width:s,height:c,base64:f,size:l(f)}},c=function t(e,i,n,r){if(i.limit--,i.limit<0)r&&r(i.validImgInfo);else{var a=s(i,e);a.size<=e.maxSize&&e.maxSize-a.size<=e.maxSize*e.offsetRatio?r&&r(a):a.size<=e.maxSize?i.ratio>.9?r&&r(a):(i.ratioMin=i.ratio,i.ratio=(i.ratioMax+i.ratio)/2,i.validImgInfo=a,t(e,i,!1,r)):(i.ratioMax=i.ratio,i.ratio=(i.ratioMin+i.ratio)/2,n&&(i.maxImgBase64=a.base64,i.ratio=.5,i.ratioMin=0,i.ratioMax=1),t(e,i,!1,r))}},g=function(t,e){var i=new window.FileReader;i.onload=function(t){var i=new window.DataView(t.target.result);if(65496===i.getUint16(0,!1)){for(var n=i.byteLength,r=2,a=void 0;r<n;){var o=i.getUint16(r,!1);if(r+=2,65505===o){1165519206!==i.getUint32(r+=2,!1)&&(a=-1);var l=18761===i.getUint16(r+=6,!1);r+=i.getUint32(r+4,l);var u=i.getUint16(r,l);r+=2;for(var h=0;h<u;h++)274===i.getUint16(r+12*h,l)&&(a=i.getUint16(r+12*h+8,l))}else{if(65280!=(65280&o))break;r+=i.getUint16(r,!1)}}e(a||-1)}else e(-2)},i.readAsArrayBuffer(t)},d=function(t){var e=null;switch(t){case 1:e=0;break;case 6:e=90;break;case 3:e=180;break;case 8:e=270;break;default:e=0}return e},m=function r(a,l){u(this,r),(a=t(a)).style.position="relative";var h={_self:this,el:a,opts:l,input:null,events:[],errorFn:null};e(h),i(h),n(h),o(h),this.$$data=h};return function(t){t.prototype.error=function(t){return this.$$data.errorFn=t,this}}(m),function(t){t.prototype.on=function(t){var e=this.$$data.events;return"function"==typeof t&&e.push(t),this},t.prototype.off=function(t){var e=this.$$data.events;return t||(this.$$data.events=[]),"function"==typeof t&&(this.$$data.events=e.filter(function(e){return e!==t})),this}}(m),function(t){t.getSize=function(t){return l(t)}}(m),function(t){t.getImgInfo=function(e,i){return f(e,i),t}}(m),function(t){t.compress=function(e,i,n){var r={maxLength:i.maxLength||1920,maxSize:i.maxSize||307200,quality:i.quality||.8,offsetRatio:i.offsetRatio||.2},a={ratio:1,ratioMax:1,ratioMin:0,limit:5,validImgInfo:"",maxImgBase64:"",width:0,height:0,img:null};return f(e,function(t,e){if(t)n&&n(t,{});else if(a.maxImgBase64=e.base64,a.width=e.width,a.height=e.height,a.img=e.img,e.width<=r.maxLength&&e.height<=r.maxLength)e.size<=r.maxSize?(n&&n(null,e),e=null):c(r,a,!1,function(t){n&&n(null,t)});else{var i=Math.max(e.width,e.height);e=null,a.ratio=a.ratioMax=r.maxLength/i,c(r,a,!0,function(t){n&&n(null,t)})}}),t}}(m),function(t){t.rotate=function(e,i){return r(e,function(t,n){t?i&&i(t,""):f(n,function(t,r){t?i&&i(t,""):g(e,function(t){if(1===t||3===t||6===t||8===t){var e=document.createElement("canvas"),a=e.getContext("2d"),o=d(t);switch(o){case 90:e.width=r.height,e.height=r.width,a.fillStyle="#fff",a.fillRect(0,0,e.width,e.height),a.translate(r.height,0),a.rotate(o*Math.PI/180),a.drawImage(r.img,0,0,e.height,e.width);break;case 180:e.width=r.width,e.height=r.height,a.fillStyle="#fff",a.fillRect(0,0,e.width,e.height),a.translate(r.width,r.height),a.rotate(o*Math.PI/180),a.drawImage(r.img,0,0,e.width,e.height);break;case 270:e.width=r.height,e.height=r.width,a.fillStyle="#fff",a.fillRect(0,0,e.width,e.height),a.translate(0,r.width),a.rotate(o*Math.PI/180),a.drawImage(r.img,0,0,e.height,e.width);break;case 0:e.width=r.width,e.height=r.height,a.fillStyle="#fff",a.fillRect(0,0,e.width,e.height),a.translate(0,0),a.rotate(o*Math.PI/180),a.drawImage(r.img,0,0,e.width,e.height)}var l=e.toDataURL("image/jpeg",.9);a=null,e=null,i&&i(null,l)}else i&&i(null,n)})})}),t}}(m),m});
