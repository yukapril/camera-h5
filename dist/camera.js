!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Camera=e()}(this,function(){"use strict";var t=function(t){return"string"==typeof t&&(t=document.querySelector(t)),t},e=function(t){var e=t.opts||{};t.opts={type:e.type||"image/jpeg"}},n=function(t){var e=document.createElement("input");e.type="file",e.setAttribute("accept","image/*"),e.setAttribute("capture","camera"),e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.display="block",e.style.width="100%",e.style.height="100%",e.style.opacity="0",t.input=e},i=function(t){t.el.appendChild(t.input)},r=function(t,e){var n=new window.FileReader;n.onload=function(t){var i=t.target.result;n=null,e&&e(null,i)},n.onerror=function(t){n=null,e&&e(t,"")},n.readAsDataURL(t)},a=function(t,e){return t.split(",").indexOf(e)>=0},o=function(t){t.input.addEventListener("change",function(e){var n=e.target.files;if(n.length>0){var i=n[0],o=i.type;if(!a(t.opts.type,o)){var l="Illegal type: "+o;return t.events.forEach(function(t){return t({type:"type",err:l},"",null)}),void(t.errorFn&&t.errorFn.call(t._self,{type:"type",err:l}))}r(i,function(e,n){if(e)return t.events.forEach(function(t){return t(e,"",null)}),void(t.errorFn&&t.errorFn.call(t._self,{type:"error file",err:"Illegal file:"+i}));t.events.forEach(function(t){return t(null,n,i)})})}})},l=function(t){var e=t.split(",")[1];return(e=e.replace(/=/g,"")).length/4*3},u=(function(){function t(t){this.value=t}function e(e){function n(r,a){try{var o=e[r](a),l=o.value;l instanceof t?Promise.resolve(l.value).then(function(t){n("next",t)},function(t){n("throw",t)}):i(o.done?"return":"normal",o.value)}catch(t){i("throw",t)}}function i(t,e){switch(t){case"return":r.resolve({value:e,done:!0});break;case"throw":r.reject(e);break;default:r.resolve({value:e,done:!1})}(r=r.next)?n(r.key,r.arg):a=null}var r,a;this._invoke=function(t,e){return new Promise(function(i,o){var l={key:t,arg:e,resolve:i,reject:o,next:null};a?a=a.next=l:(r=a=l,n(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),h=function t(e,n){u(this,t),this.width=n.width||null,this.height=n.height||null,this.size=l(e)||null,this.base64=e||null,this.img=n||null},f=function(t,e){var n=new window.Image;n.onload=function(){e&&e(null,new h(t,n)),n=null},n.onerror=function(t){n=null,e&&e(t,{})},n.src=t},s=function t(e,n,i){u(this,t),this.width=n||null,this.height=i||null,this.size=l(e)||null,this.base64=e||null},c=function(t,e){var n=e.quality,i=t.width,r=t.height,a=t.ratio,o=t.img,l=document.createElement("canvas"),u=l.getContext("2d");l.width=i*a,l.height=r*a,u.fillStyle="#fff",u.fillRect(0,0,l.width,l.height),u.drawImage(o,0,0,l.width,l.height);var h=l.toDataURL("image/jpeg",n),f=l.width,c=l.height;return u=null,l=null,new s(h,f,c)},g=function t(e,n,i,r){if(n.limit--,n.limit<0)r&&r(n.validImgInfo);else{var a=c(n,e);a.size<=e.maxSize&&e.maxSize-a.size<=e.maxSize*e.offsetRatio?r&&r(a):a.size<=e.maxSize?n.ratio>.9?r&&r(a):(n.ratioMin=n.ratio,n.ratio=(n.ratioMax+n.ratio)/2,n.validImgInfo=a,t(e,n,!1,r)):(n.ratioMax=n.ratio,n.ratio=(n.ratioMin+n.ratio)/2,i&&(n.maxImgBase64=a.base64,n.ratio=.5,n.ratioMin=0,n.ratioMax=1),t(e,n,!1,r))}},d=function(t,e){var n=new window.FileReader;n.onload=function(t){var n=new window.DataView(t.target.result);if(65496===n.getUint16(0,!1)){for(var i=n.byteLength,r=2,a=void 0;r<i;){var o=n.getUint16(r,!1);if(r+=2,65505===o){1165519206!==n.getUint32(r+=2,!1)&&(a=-1);var l=18761===n.getUint16(r+=6,!1);r+=n.getUint32(r+4,l);var u=n.getUint16(r,l);r+=2;for(var h=0;h<u;h++)274===n.getUint16(r+12*h,l)&&(a=n.getUint16(r+12*h+8,l))}else{if(65280!=(65280&o))break;r+=n.getUint16(r,!1)}}e(a||-1)}else e(-2)},n.onerror=function(){e(-3)},n.readAsArrayBuffer(t)},m=function(t){var e=null;switch(t){case 1:e=0;break;case 6:e=90;break;case 3:e=180;break;case 8:e=270;break;default:e=0}return e},v=function r(a,l){u(this,r),(a=t(a)).style.position="relative";var h={_self:this,el:a,opts:l,input:null,events:[],errorFn:null};e(h),n(h),i(h),o(h),this.$$data=h};return function(t){t.prototype.error=function(t){return this.$$data.errorFn=t,this}}(v),function(t){t.prototype.on=function(t){var e=this.$$data.events;return"function"==typeof t&&e.push(t),this},t.prototype.off=function(t){var e=this.$$data.events;return t||(this.$$data.events=[]),"function"==typeof t&&(this.$$data.events=e.filter(function(e){return e!==t})),this}}(v),function(t){t.getSize=function(t){return l(t)}}(v),function(t){t.getImgInfo=function(e,n){return f(e,n),t}}(v),function(t){t.compress=function(e,n,i){var r={maxLength:n.maxLength||1920,maxSize:n.maxSize||307200,quality:n.quality||.8,offsetRatio:n.offsetRatio||.2},a={ratio:1,ratioMax:1,ratioMin:0,limit:5,validImgInfo:"",maxImgBase64:"",width:0,height:0,img:null};return f(e,function(t,e){if(t)i&&i(t,{});else if(a.maxImgBase64=e.base64,a.width=e.width,a.height=e.height,a.img=e.img,e.width<=r.maxLength&&e.height<=r.maxLength)e.size<=r.maxSize?(i&&i(null,e),e=null):g(r,a,!1,function(t){i&&i(null,t)});else{var n=Math.max(e.width,e.height);e=null,a.ratio=a.ratioMax=r.maxLength/n,g(r,a,!0,function(t){i&&i(null,t)})}}),t}}(v),function(t){t.rotate=function(e,n){return r(e,function(t,i){t?n&&n(t,""):f(i,function(t,r){t?n&&n(t,""):d(e,function(t){if(1===t||3===t||6===t||8===t){var e=document.createElement("canvas"),a=e.getContext("2d"),o=m(t);switch(o){case 90:e.width=r.height,e.height=r.width,a.fillStyle="#fff",a.fillRect(0,0,e.width,e.height),a.translate(r.height,0),a.rotate(o*Math.PI/180),a.drawImage(r.img,0,0,e.height,e.width);break;case 180:e.width=r.width,e.height=r.height,a.fillStyle="#fff",a.fillRect(0,0,e.width,e.height),a.translate(r.width,r.height),a.rotate(o*Math.PI/180),a.drawImage(r.img,0,0,e.width,e.height);break;case 270:e.width=r.height,e.height=r.width,a.fillStyle="#fff",a.fillRect(0,0,e.width,e.height),a.translate(0,r.width),a.rotate(o*Math.PI/180),a.drawImage(r.img,0,0,e.height,e.width);break;case 0:e.width=r.width,e.height=r.height,a.fillStyle="#fff",a.fillRect(0,0,e.width,e.height),a.translate(0,0),a.rotate(o*Math.PI/180),a.drawImage(r.img,0,0,e.width,e.height)}var l=e.toDataURL("image/jpeg",.9);a=null,e=null,n&&n(null,l)}else n&&n(null,i)})})}),t}}(v),v});
