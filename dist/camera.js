!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Camera=e()}(this,function(){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){var i=new window.FileReader;i.onload=function(t){t=t.target.result;i=null,e&&e(null,t)},i.onerror=function(t){i=null,e&&e(t,"")},i.readAsDataURL(t)}function a(o){o.input.addEventListener("change",function(e){o.events.forEach(function(t){return t.onChange(e)});var t,i=e.target.files;if(0<i.length){var n=i[0],a=n.type;if(t=o.opts.type,i=a,!(0<=t.split(",").indexOf(i))){var r="Illegal type: "+a;return o.events.forEach(function(t){return t.onChanged({type:"type",err:r},"",null)}),void(o.errorFn&&o.errorFn.call(o._self,{type:"type",err:r}))}l(n,function(e,i){return e?(o.events.forEach(function(t){return t.onChanged(e,"",null)}),void(o.errorFn&&o.errorFn.call(o._self,{type:"error file",err:"Illegal file:"+n}))):void o.events.forEach(function(t){return t.onChanged(null,i,n)})})}})}function r(t){return t.split(",")[1].replace(/=/g,"").length/4*3}function o(t,e){n(this,o),this.width=e.width||null,this.height=e.height||null,this.size=r(t)||null,this.base64=t||null,this.img=e||null}function h(t,e){var i=new window.Image;i.onload=function(){e&&e(null,new o(t,i)),i=null},i.onerror=function(t){i=null,e&&e(t,{})},i.src=t}function u(t,e,i){n(this,u),this.width=e||null,this.height=i||null,this.size=r(t)||null,this.base64=t||null}function f(t,e,i,n){var a;e.limit--,e.limit<0?n&&n(e.validImgInfo):(a=function(t,e){var i=e.quality,n=t.width,a=t.height,r=t.ratio,o=t.img,t=(e=document.createElement("canvas")).getContext("2d");e.width=n*r,e.height=a*r,t.fillStyle="#fff",t.fillRect(0,0,e.width,e.height),t.drawImage(o,0,0,e.width,e.height);r=e.toDataURL("image/jpeg",i),o=e.width,i=e.height,t=null,e=null;return new u(r,o,i)}(e,t)).size<=t.maxSize&&t.maxSize-a.size<=t.maxSize*t.offsetRatio?n&&n(a):a.size<=t.maxSize?.9<e.ratio?n&&n(a):(e.ratioMin=e.ratio,e.ratio=(e.ratioMax+e.ratio)/2,e.validImgInfo=a,f(t,e,!1,n)):(e.ratioMax=e.ratio,e.ratio=(e.ratioMin+e.ratio)/2,i&&(e.maxImgBase64=a.base64,e.ratio=.5,e.ratioMin=0,e.ratioMax=1),f(t,e,!1,n))}function s(e){var i=document.createElement("img");document.body.appendChild(i),i.onerror=function(){var t="from-image"===window.getComputedStyle(i).imageOrientation;document.body.removeChild(i),i=null,e&&e(t)},i.src=""}function c(t,n,a,r){var e,u;e=t,u=function(t){if(1===t||3===t||6===t||8===t){var e=(i=document.createElement("canvas")).getContext("2d"),t=function(t){var e=null;switch(t){case 1:e=0;break;case 6:e=90;break;case 3:e=180;break;case 8:e=270;break;default:e=0}return e}(t);switch(t){case 90:i.width=n.height,i.height=n.width,e.fillStyle="#fff",e.fillRect(0,0,i.width,i.height),e.translate(n.height,0),e.rotate(t*Math.PI/180),e.drawImage(n.img,0,0,i.height,i.width);break;case 180:i.width=n.width,i.height=n.height,e.fillStyle="#fff",e.fillRect(0,0,i.width,i.height),e.translate(n.width,n.height),e.rotate(t*Math.PI/180),e.drawImage(n.img,0,0,i.width,i.height);break;case 270:i.width=n.height,i.height=n.width,e.fillStyle="#fff",e.fillRect(0,0,i.width,i.height),e.translate(0,n.width),e.rotate(t*Math.PI/180),e.drawImage(n.img,0,0,i.height,i.width);break;case 0:i.width=n.width,i.height=n.height,e.fillStyle="#fff",e.fillRect(0,0,i.width,i.height),e.translate(0,0),e.rotate(t*Math.PI/180),e.drawImage(n.img,0,0,i.width,i.height)}var t=i.toDataURL("image/jpeg",.9),e=null,i=null;r&&r(null,t)}else r&&r(null,a)},(t=new window.FileReader).onload=function(t){var e=new window.DataView(t.target.result);if(65496===e.getUint16(0,!1)){for(var i,n=e.byteLength,a=2;a<n;){var r=e.getUint16(a,!1);if(a+=2,65505===r){1165519206!==e.getUint32(a+=2,!1)&&(i=-1);var o=18761===e.getUint16(a+=6,!1);a+=e.getUint32(a+4,o);var l=e.getUint16(a,o);a+=2;for(var h=0;h<l;h++)274===e.getUint16(a+12*h,o)&&(i=e.getUint16(a+12*h+8,o))}else{if(65280!=(65280&r))break;a+=e.getUint16(a,!1)}}u(i||-1)}else u(-2)},t.onerror=function(){u(-3)},t.readAsArrayBuffer(e)}function g(t,e){n(this,g),"string"==typeof(i=t)&&(i=document.querySelector(i)),(t=i).style.position="relative";var i={_self:this,el:t,opts:e,input:null,events:[],errorFn:null};e=(t=i).opts||{},t.opts={type:e.type||"image/jpeg",capture:e.capture||"camera"},function(t){var e=null;switch(t.opts.capture){case"camera":e="camera";break;case"user":e="user";break;case"none":e="";break;default:e="camera"}var i=document.createElement("input");i.type="file",i.setAttribute("accept","image/*"),e&&i.setAttribute("capture",e),i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.zIndex="9999",i.style.display="block",i.style.width="100%",i.style.height="100%",i.style.opacity="0",t.input=i}(i),(e=i).el.appendChild(e.input),a(i),this.$$data=i}var t,i,d,e;return g.prototype.error=function(t){return this.$$data.errorFn=t,this},(t=g).prototype.on=function(t,e){var i=this.$$data.events;return"function"!=typeof e&&(e=function(){}),"function"==typeof t&&i.push({onChanged:t,onChange:e}),this},t.prototype.off=function(e){var t=this.$$data.events;return e||(this.$$data.events=[]),"function"==typeof e&&(this.$$data.events=t.filter(function(t){return t.onChanged!==e})),this},g.getSize=r,(i=g).getImgInfo=function(t,e){return h(t,e),i},(d=g).compress=function(t,e,i){var n={maxLength:e.maxLength||1920,maxSize:e.maxSize||307200,quality:e.quality||.8,offsetRatio:e.offsetRatio||.2},a={ratio:1,ratioMax:1,ratioMin:0,limit:5,validImgInfo:"",maxImgBase64:"",width:0,height:0,img:null};return h(t,function(t,e){t?i&&i(t,{}):(a.maxImgBase64=e.base64,a.width=e.width,a.height=e.height,a.img=e.img,e.width<=n.maxLength&&e.height<=n.maxLength?e.size<=n.maxSize?(i&&i(null,e),e=null):f(n,a,!1,function(t){i&&i(null,t)}):(t=Math.max(e.width,e.height),e=null,a.ratio=a.ratioMax=n.maxLength/t,f(n,a,!0,function(t){i&&i(null,t)})))}),d},(e=g).rotate=function(n,a){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return l(n,function(t,i){t?a&&a(t,""):h(i,function(t,e){t?a&&a(t,""):r.auto?s(function(t){t?a(null,i):c(n,e,i,a)}):c(n,e,i,a)})}),e},g.isRotated=function(t){s(t)},g});
