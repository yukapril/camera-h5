!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Camera=e()}(this,(function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(a=n.key,r=void 0,"symbol"==typeof(r=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(a,"string"))?r:String(r)),n)}var a,r}function i(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var n=function(t){var e=t.split(",")[1];return(e=e.replace(/=/g,"")).length/4*3};function a(t){return t.substring(5,t.indexOf(";"))}var r=i((function e(i,r,l){t(this,e),this.width=r||null,this.height=l||null,this.size=n(i)||null,this.base64=i||null,this.type=a(i)})),l=i((function e(i,r){t(this,e),this.width=r.width||null,this.height=r.height||null,this.size=n(i)||null,this.base64=i||null,this.type=a(i),this.img=r||null})),o=function(t,e){var i=new window.Image;i.onload=function(){e&&e(null,new l(t,i)),i=null},i.onerror=function(t){i=null,e&&e(t,{})},i.src=t},u=function t(e,i,n,a){if(i.limit--,i.limit<0)a&&a(i.validImgInfo);else{var l=function(t,e){var i=e.type,n=e.quality,a=t.width,l=t.height,o=t.ratio,u=t.img,h=document.createElement("canvas"),f=h.getContext("2d");h.width=a*o,h.height=l*o,f.fillStyle="#fff",f.fillRect(0,0,h.width,h.height),f.drawImage(u,0,0,h.width,h.height);var c=h.toDataURL(i,n),g=h.width,d=h.height;return f=null,h=null,new r(c,g,d)}(i,e);l.size<=e.maxSize&&e.maxSize-l.size<=e.maxSize*e.offsetRatio?a&&a(l):l.size<=e.maxSize?i.ratio>.9?a&&a(l):(i.ratioMin=i.ratio,i.ratio=(i.ratioMax+i.ratio)/2,i.validImgInfo=l,t(e,i,!1,a)):(i.ratioMax=i.ratio,i.ratio=(i.ratioMin+i.ratio)/2,n&&(i.maxImgBase64=l.base64,i.ratio=.5,i.ratioMin=0,i.ratioMax=1),t(e,i,!1,a))}},h=function(t,e){var i=new window.FileReader;i.onload=function(t){var n=t.target.result;i=null,e&&e(null,n)},i.onerror=function(t){i=null,e&&e(t,"")},i.readAsDataURL(t)},f=function(t){var e=document.createElement("img");e.onload=function(){var i="from-image"===window.getComputedStyle(e).imageOrientation;document.body.removeChild(e),e=null,t&&t(i)},document.body.appendChild(e),e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAApJREFUCNdjYAAAAAIAAeIhvDMAAAAASUVORK5CYII="},c=function(t,e,i,n,a,r){!function(t,e){var i=new window.FileReader;i.onload=function(t){var i=new window.DataView(t.target.result);if(65496===i.getUint16(0,!1)){for(var n,a=i.byteLength,r=2;r<a;){var l=i.getUint16(r,!1);if(r+=2,65505===l){1165519206!==i.getUint32(r+=2,!1)&&(n=-1);var o=18761===i.getUint16(r+=6,!1);r+=i.getUint32(r+4,o);var u=i.getUint16(r,o);r+=2;for(var h=0;h<u;h++)274===i.getUint16(r+12*h,o)&&(n=i.getUint16(r+12*h+8,o))}else{if(65280!=(65280&l))break;r+=i.getUint16(r,!1)}}e(n||-1)}else e(-2)},i.onerror=function(){e(-3)},i.readAsArrayBuffer(t)}(t,(function(t){if(1===t||3===t||6===t||8===t){var l=document.createElement("canvas"),o=l.getContext("2d"),u=function(t){var e=null;switch(t){case 1:default:e=0;break;case 6:e=90;break;case 3:e=180;break;case 8:e=270}return e}(t);switch(u){case 90:l.width=e.height,l.height=e.width,o.fillStyle="#fff",o.fillRect(0,0,l.width,l.height),o.translate(e.height,0),o.rotate(u*Math.PI/180),o.drawImage(e.img,0,0,l.height,l.width);break;case 180:l.width=e.width,l.height=e.height,o.fillStyle="#fff",o.fillRect(0,0,l.width,l.height),o.translate(e.width,e.height),o.rotate(u*Math.PI/180),o.drawImage(e.img,0,0,l.width,l.height);break;case 270:l.width=e.height,l.height=e.width,o.fillStyle="#fff",o.fillRect(0,0,l.width,l.height),o.translate(0,e.width),o.rotate(u*Math.PI/180),o.drawImage(e.img,0,0,l.height,l.width);break;case 0:l.width=e.width,l.height=e.height,o.fillStyle="#fff",o.fillRect(0,0,l.width,l.height),o.translate(0,0),o.rotate(u*Math.PI/180),o.drawImage(e.img,0,0,l.width,l.height)}var h=l.toDataURL(a,r);o=null,l=null,n&&n(null,h)}else n&&n(null,i)}))};var g=i((function e(i){t(this,e),this.opts=i,this.options=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:t.type||"image/jpeg",capture:t.capture||"camera",change:t.change||function(){},changed:t.changed||function(){}}}(i),function(t){var e=null,i=null;switch(t.capture){case"camera":default:i="camera";break;case"user":i="user";break;case"none":i=""}var n=function(){e&&e.parentNode&&(e.parentNode.removeChild(e),e=null)};return{create:function(){return(e=document.createElement("input")).type="file",e.style.opacity="0",e.style.width="0",e.style.height="0",e.setAttribute("accept","image/*"),i&&e.setAttribute("capture",i),document.body.appendChild(e),e.addEventListener("change",(function(e){n(),t.change(e);var i,a=e.target.files;if(a.length>0){var r=a[0],l=r.type;if(i=l,!(t.type.split(",").indexOf(i)>=0)){var o="Illegal type: "+l;return void t.changed({type:"type",err:o},"",null)}h(r,(function(e,i){e?t.changed({type:"error file",err:"Illegal file:"+r,error:e},"",null):t.changed(null,i,r)}))}})),e.click(),e},remove:n}}(this.options).create()}));return g.getSize=function(t){return n(t)},function(t){t.getImgInfo=function(t,e){return o(t,e)}}(g),function(t){t.compress=function(t,e,i){var n={maxLength:e.maxLength||1920,maxSize:e.maxSize||307200,type:e.type||"image/jpeg",quality:e.quality||.8,offsetRatio:e.offsetRatio||.2},a={ratio:1,ratioMax:1,ratioMin:0,limit:5,validImgInfo:"",maxImgBase64:"",width:0,height:0,img:null};o(t,(function(t,e){if(t)i&&i(t,{});else if(a.maxImgBase64=e.base64,a.width=e.width,a.height=e.height,a.img=e.img,n.type!==e.type)u(n,a,!0,(function(t){i&&i(null,t)}));else if(e.width<=n.maxLength&&e.height<=n.maxLength)e.size<=n.maxSize?(i&&i(null,e),e=null):u(n,a,!1,(function(t){i&&i(null,t)}));else{var r=Math.max(e.width,e.height);e=null,a.ratio=a.ratioMax=n.maxLength/r,u(n,a,!0,(function(t){i&&i(null,t)}))}}))}}(g),function(t){t.rotate=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n={type:i.type||"image/jpeg",quality:i.quality||90,auto:!!i.auto};h(t,(function(i,a){i?e&&e(i,""):o(a,(function(i,r){i?e&&e(i,""):n.auto?f((function(i){i?e(null,a):c(t,r,a,e,n.type,n.quality)})):c(t,r,a,e,n.type,n.quality)}))}))}}(g),function(t){t.isRotated=function(t){return f(t)}}(g),g}));
