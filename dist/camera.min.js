!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Camera=e()}(this,(function(){"use strict";function t(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(e,i){for(var n=0;n<i.length;n++){var a=i[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,t(a.key),a)}}function n(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var a=function(t){var e=t.split(",")[1];return(e=e.replace(/=/g,"")).length/4*3};function r(t){return t.substring(5,t.indexOf(";"))}var o=n((function t(i,n,o){e(this,t),this.width=n||null,this.height=o||null,this.size=a(i)||null,this.base64=i||null,this.type=r(i)})),l=n((function t(i,n){e(this,t),this.width=n.width||null,this.height=n.height||null,this.size=a(i)||null,this.base64=i||null,this.type=r(i),this.img=n||null})),u=function(t,e){var i=new window.Image;i.onload=function(){e&&e(null,new l(t,i)),i=null},i.onerror=function(t){i=null,e&&e(t,{})},i.src=t},h=function t(e,i,n,a){if(i.limit--,i.limit<0)a&&a(i.validImgInfo);else{var r=function(t,e){var i=e.type,n=e.quality,a=t.width,r=t.height,l=t.ratio,u=t.img,h=document.createElement("canvas"),c=h.getContext("2d");h.width=a*l,h.height=r*l,c.fillStyle="#fff",c.fillRect(0,0,h.width,h.height),c.drawImage(u,0,0,h.width,h.height);var f=h.toDataURL(i,n),g=h.width,s=h.height;return c=null,h=null,new o(f,g,s)}(i,e);r.size<=e.maxSize&&e.maxSize-r.size<=e.maxSize*e.offsetRatio?a&&a(r):r.size<=e.maxSize?i.ratio>.9?a&&a(r):(i.ratioMin=i.ratio,i.ratio=(i.ratioMax+i.ratio)/2,i.validImgInfo=r,t(e,i,!1,a)):(i.ratioMax=i.ratio,i.ratio=(i.ratioMin+i.ratio)/2,n&&(i.maxImgBase64=r.base64,i.ratio=.5,i.ratioMin=0,i.ratioMax=1),t(e,i,!1,a))}},c=function(t,e){var i=new window.FileReader;i.onload=function(t){var n=t.target.result;i=null,e&&e(null,n)},i.onerror=function(t){i=null,e&&e(t,"")},i.readAsDataURL(t)},f=function(t){var e=document.createElement("img");e.onload=function(){var i="from-image"===window.getComputedStyle(e).imageOrientation;document.body.removeChild(e),e=null,t&&t(i)},document.body.appendChild(e),e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAApJREFUCNdjYAAAAAIAAeIhvDMAAAAASUVORK5CYII="},g=function(t,e,i,n,a,r){!function(t,e){var i=new window.FileReader;i.onload=function(t){var i=new window.DataView(t.target.result);if(65496===i.getUint16(0,!1)){for(var n,a=i.byteLength,r=2;r<a;){var o=i.getUint16(r,!1);if(r+=2,65505===o){1165519206!==i.getUint32(r+=2,!1)&&(n=-1);var l=18761===i.getUint16(r+=6,!1);r+=i.getUint32(r+4,l);var u=i.getUint16(r,l);r+=2;for(var h=0;h<u;h++)274===i.getUint16(r+12*h,l)&&(n=i.getUint16(r+12*h+8,l))}else{if(65280&~o)break;r+=i.getUint16(r,!1)}}e(n||-1)}else e(-2)},i.onerror=function(){e(-3)},i.readAsArrayBuffer(t)}(t,(function(t){if(1===t||3===t||6===t||8===t){var o=document.createElement("canvas"),l=o.getContext("2d"),u=function(t){var e=null;switch(t){case 1:default:e=0;break;case 6:e=90;break;case 3:e=180;break;case 8:e=270}return e}(t);switch(u){case 90:o.width=e.height,o.height=e.width,l.fillStyle="#fff",l.fillRect(0,0,o.width,o.height),l.translate(e.height,0),l.rotate(u*Math.PI/180),l.drawImage(e.img,0,0,o.height,o.width);break;case 180:o.width=e.width,o.height=e.height,l.fillStyle="#fff",l.fillRect(0,0,o.width,o.height),l.translate(e.width,e.height),l.rotate(u*Math.PI/180),l.drawImage(e.img,0,0,o.width,o.height);break;case 270:o.width=e.height,o.height=e.width,l.fillStyle="#fff",l.fillRect(0,0,o.width,o.height),l.translate(0,e.width),l.rotate(u*Math.PI/180),l.drawImage(e.img,0,0,o.height,o.width);break;case 0:o.width=e.width,o.height=e.height,l.fillStyle="#fff",l.fillRect(0,0,o.width,o.height),l.translate(0,0),l.rotate(u*Math.PI/180),l.drawImage(e.img,0,0,o.width,o.height)}var h=o.toDataURL(a,r);l=null,o=null,n&&n(null,h)}else n&&n(null,i)}))};var s=n((function t(i){e(this,t),this.opts=i,this.options=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:t.type||"image/jpeg",capture:t.capture||"camera",change:t.change||function(){},changed:t.changed||function(){}}}(i),function(t){var e=null,i=null;switch(t.capture){case"camera":default:i="camera";break;case"user":i="user";break;case"none":i=""}var n=function(){e&&e.parentNode&&(e.parentNode.removeChild(e),e=null)};return{create:function(){return(e=document.querySelector("#CameraH5Input"))?i?e.setAttribute("capture",i):e.removeAttribute("capture"):((e=document.createElement("input")).id="CameraH5Input",e.type="file",e.style.opacity="0",e.style.width="0",e.style.height="0",e.setAttribute("accept","image/*"),i?e.setAttribute("capture",i):e.removeAttribute("capture"),document.body.appendChild(e)),e.addEventListener("change",(function(e){console.log("[camera-h5]","图片发生改变"),t.change(e);var i,a=e.target.files;if(a.length>0){var r=a[0],o=r.type;if(i=o,!(t.type.split(",").indexOf(i)>=0)){var l="Illegal type: "+o;return console.log("[camera-h5]","图片改变完成，checkTypeErr：",l),t.changed({type:"type",err:l},"",null),void n()}c(r,(function(e,i){if(e)return console.log("[camera-h5]","图片改变完成，fileReaderErr：",e),t.changed({type:"error file",err:"Illegal file:"+r,error:e},"",null),void n();console.log("[camera-h5]","图片改变完成，success"),t.changed(null,i,r),n()}))}})),e.click(),e},remove:n}}(this.options).create()}));return s.getSize=function(t){return a(t)},function(t){t.getImgInfo=function(t,e){return u(t,e)}}(s),function(t){t.compress=function(t,e,i){var n={maxLength:e.maxLength||1920,maxSize:e.maxSize||307200,type:e.type||"image/jpeg",quality:e.quality||.8,offsetRatio:e.offsetRatio||.2},a={ratio:1,ratioMax:1,ratioMin:0,limit:5,validImgInfo:"",maxImgBase64:"",width:0,height:0,img:null};u(t,(function(t,e){if(t)i&&i(t,{});else if(a.maxImgBase64=e.base64,a.width=e.width,a.height=e.height,a.img=e.img,n.type!==e.type)h(n,a,!0,(function(t){i&&i(null,t)}));else if(e.width<=n.maxLength&&e.height<=n.maxLength)e.size<=n.maxSize?(i&&i(null,e),e=null):h(n,a,!1,(function(t){i&&i(null,t)}));else{var r=Math.max(e.width,e.height);e=null,a.ratio=a.ratioMax=n.maxLength/r,h(n,a,!0,(function(t){i&&i(null,t)}))}}))}}(s),function(t){t.rotate=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n={type:i.type||"image/jpeg",quality:i.quality||90,auto:!!i.auto};c(t,(function(i,a){i?e&&e(i,""):u(a,(function(i,r){i?e&&e(i,""):n.auto?f((function(i){i?e(null,a):g(t,r,a,e,n.type,n.quality)})):g(t,r,a,e,n.type,n.quality)}))}))}}(s),function(t){t.isRotated=function(t){return f(t)}}(s),s}));
